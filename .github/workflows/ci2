  #
  # Run test projects on linux
  #

  run-linux-x64-debug:
    strategy:
      fail-fast: false
      matrix:
        task: [ubuntu-latest-linux-x64-debug]
        artifact: [helloworld]
    runs-on: ubuntu-latest
    needs: [build-ubuntu-latest, build-ubuntu-latest-linux-x64-debug]
    steps:
    - uses: actions/download-artifact@v2
      with:
        name: ${{ matrix.task }}-${{ matrix.artifact }}
    - uses: actions/download-artifact@v2
      with:
        name: ubuntu-latest-xrun
    - run: chmod +x ./xrun
    - run: tar --zstd -xf ${{ matrix.artifact }}.AppDir.tar.zst
    - run: ./xrun --path ${{ matrix.artifact }}.AppDir/AppRun

  run-linux-x64-release:
    strategy:
      fail-fast: false
      matrix:
        task: [ubuntu-latest-linux-x64-release]
        artifact: [helloworld]
    runs-on: ubuntu-latest
    needs: [build-ubuntu-latest, build-ubuntu-latest-linux-x64-release]
    steps:
    - uses: actions/download-artifact@v2
      with:
        name: ${{ matrix.task }}-${{ matrix.artifact }}
    - uses: actions/download-artifact@v2
      with:
        name: ubuntu-latest-xrun
    - run: chmod +x ./xrun
    - run: chmod +x ${{ matrix.artifact }}.AppImage
    - run: ./xrun --path ${{ matrix.artifact }}.AppImage

  #
  # Run test projects on macos
  #

  run-macos-x64-debug:
    strategy:
      fail-fast: false
      matrix:
        task:
        - ubuntu-latest-macos-x64-debug
        - macos-latest-macos-x64-debug
        - windows-latest-macos-x64-debug
        artifact: [helloworld]
    runs-on: macos-latest
    if: ${{ always() }}
    needs:
    - build-macos-latest
    - build-ubuntu-latest-macos-x64-debug
    - build-macos-latest-macos-x64-debug
    - build-windows-latest-macos-x64-debug
    steps:
    - uses: actions/download-artifact@v2
      with:
        name: ${{ matrix.task }}-${{ matrix.artifact }}
    - uses: actions/download-artifact@v2
      with:
        name: macos-latest-xrun
    - run: chmod +x ./xrun
    - run: gtar --zstd -xf ${{ matrix.artifact }}.app.tar.zst
    - run: ./xrun --path ${{ matrix.artifact }}.app/Contents/MacOS/${{ matrix.artifact }}

  #
  # Run test projects on windows
  #

  run-windows-x64-debug:
    strategy:
      fail-fast: false
      matrix:
        task:
        - ubuntu-latest-windows-x64-debug
        - macos-latest-windows-x64-debug
        - windows-latest-windows-x64-debug
        artifact: [helloworld]
    runs-on: windows-latest
    if: ${{ always() }}
    needs:
    - build-windows-latest
    - build-ubuntu-latest-windows-x64-debug
    - build-macos-latest-windows-x64-debug
    - build-windows-latest-windows-x64-debug
    steps:
    - uses: actions/download-artifact@v2
      with:
        name: ${{ matrix.task }}-${{ matrix.artifact }}
    - uses: actions/download-artifact@v2
      with:
        name: windows-latest-xrun
    - run: 7z x ${{ matrix.artifact }}.msix
    - run: ./xrun.exe --path ${{ matrix.artifact }}.exe
